// --------------------------------------------------------------------------------------------------------------------
// <copyright file="TypeDummyFactory.cs" company="OBeautifulCode">
//   Copyright (c) OBeautifulCode 2018. All rights reserved.
// </copyright>
// <auto-generated>
//   Sourced from NuGet package. Will be overwritten with package update except in OBeautifulCode.Type.Test source.
// </auto-generated>
// --------------------------------------------------------------------------------------------------------------------

namespace OBeautifulCode.Type.Test
{
    using global::System;
    using global::System.Collections.Generic;
    using global::System.Linq;

    using FakeItEasy;

    using OBeautifulCode.AutoFakeItEasy;
    using OBeautifulCode.Math.Recipes;

    /// <summary>
    /// A Dummy Factory for types in <see cref="OBeautifulCode.Type"/>.
    /// </summary>
#if !OBeautifulCodeTypeSolution
    [System.Diagnostics.CodeAnalysis.ExcludeFromCodeCoverage]
    [System.CodeDom.Compiler.GeneratedCode("OBeautifulCode.Type.Test", "See package version number")]
    internal
#else
    public
#endif
    class TypeDummyFactory : DefaultTypeDummyFactory
    {
        private static readonly IReadOnlyList<Type> LoadedTypes =
            AppDomain
                .CurrentDomain
                .GetAssemblies()
                .Where(a => (a != null) && (!a.IsDynamic))
                .SelectMany(_ => _.GetTypes())
                .Where(_ => _ != null)
                .Where(_ => !string.IsNullOrWhiteSpace(_.Namespace))
                .ToList();

        private static readonly IReadOnlyList<Type> AppDomainClosedTypes =
            LoadedTypes
                .Where(_ => !_.ContainsGenericParameters)
                .ToList();

        private static readonly IReadOnlyList<Type> AppDomainGenericTypeDefinitions =
            LoadedTypes
                .Where(_ => _.IsGenericTypeDefinition)
                .ToList();

        public TypeDummyFactory()
        {
            AutoFixtureBackedDummyFactory.ConstrainDummyToExclude(CurrencyCode.Unknown);
            AutoFixtureBackedDummyFactory.ConstrainDummyToExclude(CultureKind.Unknown);
            AutoFixtureBackedDummyFactory.ConstrainDummyToExclude(DateTimeFormatKind.Unknown);
            AutoFixtureBackedDummyFactory.ConstrainDummyToExclude(MissingProtocolStrategy.Unknown);
            AutoFixtureBackedDummyFactory.ConstrainDummyToExclude(StandardTimeZone.Unknown);
            AutoFixtureBackedDummyFactory.ConstrainDummyToExclude(TypeSelectionStrategy.Unknown);

            // UtcDateTimeRangeInclusive
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
            {
                var startDateTime = A.Dummy<DateTime>();

                var endDateTime = A.Dummy<DateTime>().ThatIs(_ => _ >= startDateTime);

                var result = new UtcDateTimeRangeInclusive(startDateTime.ToUniversalTime(), endDateTime.ToUniversalTime());

                return result;
            });

            // Range<T>
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
                {
                    var start = A.Dummy<Version>();

                    var end = A.Dummy<Version>().ThatIs(_ => _ >= start);

                    var result = new Range<Version>(start, end);

                    return result;
                });

            // Type
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
                {
                    Type result;

                    if (ThreadSafeRandom.Next(0, 2) == 0)
                    {
                        result = GetRandomClosedTypeInAppDomain();
                    }
                    else
                    {
                        while (true)
                        {
                            var genericTypeDefinition = GetRandomGenericTypeDefinitionInAppDomain();

                            var typeArguments = Enumerable.Range(0, genericTypeDefinition.GetGenericArguments().Length).Select(_ => GetRandomClosedTypeInAppDomain()).ToArray();

                            try
                            {
                                result = genericTypeDefinition.MakeGenericType(typeArguments);

                                break;
                            }
                            catch (Exception)
                            {
                            }
                        }
                    }

                    return result;
                });

            // IOperation
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
                {
                    var result = (IOperation)A.Dummy<OperationBase>();

                    return result;
                });

            // IReturningOperation<Version>
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
                {
                    var result = (IReturningOperation<Version>)A.Dummy<ReturningOperationBase<Version>>();

                    return result;
                });

            // IVoidOperation
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
                {
                    var result = (IVoidOperation)A.Dummy<VoidOperationBase>();

                    return result;
                });

            // IValue
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
                {
                    var result = (IValue)A.Dummy<SimpleValue<Version>>();

                    return result;
                });

            // INamedValue
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () =>
                {
                    var result = (INamedValue)A.Dummy<NamedValue<Version>>();

                    return result;
                });

            // NullEvent
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () => new NullEvent(
                    A.Dummy<DateTime>().ToUniversalTime()));

            // NullEvent<Version>
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () => new NullEvent<Version>(
                    A.Dummy<Version>(),
                    A.Dummy<DateTime>().ToUniversalTime()));

            // ExecuteOpRequestedEvent<GetProtocolOp>
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () => new ExecuteOpRequestedEvent<GetProtocolOp>(
                    A.Dummy<GetProtocolOp>(),
                    A.Dummy<DateTime>().ToUniversalTime(),
                    A.Dummy<string>()));

            // ExecuteOpRequestedEvent<Version, GetProtocolOp>
            AutoFixtureBackedDummyFactory.AddDummyCreator(
                () => new ExecuteOpRequestedEvent<Version, GetProtocolOp>(
                    A.Dummy<Version>(),
                    A.Dummy<GetProtocolOp>(),
                    A.Dummy<DateTime>().ToUniversalTime(),
                    A.Dummy<string>()));
        }

        private Type GetRandomClosedTypeInAppDomain()
        {
            var randomIndex = ThreadSafeRandom.Next(0, AppDomainClosedTypes.Count);

            var result = AppDomainClosedTypes[randomIndex];

            return result;
        }

        private Type GetRandomGenericTypeDefinitionInAppDomain()
        {
            var randomIndex = ThreadSafeRandom.Next(0, AppDomainGenericTypeDefinitions.Count);

            var result = AppDomainGenericTypeDefinitions[randomIndex];

            return result;
        }
    }
}